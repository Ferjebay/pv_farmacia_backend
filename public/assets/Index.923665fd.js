import{Q as D}from"./QSpace.290b7cf2.js";import{_ as S,d as A,r as i,o as p,c as B,f as a,g as l,aT as M,ag as N,e as t,aV as j,Q as V,i as b,ac as z,ad as I,aa as g,ab as E,h as y,aX as J,aW as P,Y as k}from"./index.e02e0fd9.js";import{Q as L,a as Q}from"./QTable.7676999b.js";import{Q as v}from"./QBadge.5c85781b.js";import{Q as T}from"./QPage.b9acbce1.js";import{Q as O,a as H,C as U}from"./ClosePopup.a58b803f.js";import{Q as R}from"./QForm.0c336d83.js";import{A as q}from"./Api.e3a65a9d.js";import{u as W}from"./useRolPermisos.82749469.js";import{u as X}from"./useHelpers.6f57171d.js";import"./QList.ffb79e57.js";import"./date.cb1dcd19.js";import"./index.2cf0d985.js";const Y=[{name:"id",label:"#",align:"left",field:"id",sortable:!0},{name:"cod_barra",align:"center",label:"Codigo de Barra",field:"cod_barra"},{name:"nombre",align:"center",label:"Nombre",field:"producto"},{name:"fecha_cad",align:"center",label:"F. Vencimiento",field:"fecha_caducidad"},{name:"tiempo_cad",align:"center",label:"Dias por Caducar",field:"diasPorCaducar"},{name:"cajas",label:"Stock Cajas",align:"center",field:"totalCajas"},{name:"fracciones",label:"Stock Fracciones",align:"center",field:"totalFracciones"},{name:"estado",label:"Estado",align:"center",field:"estado"},{name:"acciones",label:"acciones",align:"center"}],G=A({name:"productosACaducar",setup(){const{validarPermisos:o}=W(),s=i(""),h=i([]),_=i(!1),m=i(!1),f=i(!1),e=i({}),d=i({id:"",fecha_caducidad_update:"",producto_update:""}),{mostrarNotify:x}=X(),C=async()=>{_.value=!0;try{const{data:{articulos:r}}=await q.get("/articulos/productosByExpirar");r.map(c=>{const n=c.fracciones_total,u=c.fxc;c.totalCajas=n!==0?parseInt(n/u):0,c.totalFracciones=n!==0?parseInt(n%u):0;let w=c.fecha_caducidad.split("T")[0].split("-");c.fecha_caducidad=`${w[2]}/${w[1]}/${w[0]}`}),h.value=r}catch(r){console.log(r)}_.value=!1},$=({id:r,producto:c,fecha_caducidad:n})=>{f.value=!0,d.value.producto_update=c,d.value.id=r;const u=n.split("/");d.value.fecha_caducidad_update=`${u[2]}/${u[1]}/${u[0]}`},F=async()=>{try{m.value=!0,await q.put(`/articulos/updateDate/${d.value.id}`,d.value),x("positive","Fecha de caducidad actualizado Exitosamente"),f.value=!1,C(),m.value=!1}catch(r){console.log(r),m.value=!1}};return C(),{columns:Y,filter:s,getProductosByCaducar:C,modalUpdateDate:f,loading:_,loadingUpdate:m,categoriaData:e,productUpdate:d,rows:h,validarPermisos:o,myLocale:{days:"Domingo_Lunes_Martes_Mi\xE9rcoles_Jueves_Viernes_S\xE1bado".split("_"),daysShort:"Dom_Lun_Mar_Mi\xE9_Jue_Vie_S\xE1b".split("_"),months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),monthsShort:"Ene_Feb_Mar_Abr_May_Jun_Jul_Ago_Sep_Oct_Nov_Dic".split("_"),firstDayOfWeek:1,format24h:!0,pluralDay:"dias"},updateDateProduct:$,submit:F}}}),K=t("div",{class:"col-md-6"},[t("label",{class:"text-h6"},"Listado de Productos Caducados")],-1),Z=[K],ee={class:"row"},ae={class:"col-md-12 col-xs-12"},oe={class:"q-pa-md"},le={class:"full-width row flex-center text-lime-10 q-gutter-sm"},te=t("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1),se=t("div",{class:"text-h6 text-center"},"Actualizar Fecha de Caducidad",-1),de={class:"col-xs-10 col-sm-3"},re={class:"offset-1 col-xs-10 col-sm-4 q-mb-lg"},ce=t("label",null,"Producto:",-1),ie=t("label",null,"Fecha de Caducidad:",-1),ne={class:"row items-center justify-end"},ue={class:"col-xs-9 col-sm-12 flex justify-center q-mt-lg"};function me(o,s,h,_,m,f){return p(),B(N,null,[a(T,null,{default:l(()=>[t("div",{class:j(["row q-py-lg q-pl-md",o.$q.screen.xs?"justify-center":"justify-between"])},Z,2),t("div",ee,[t("div",ae,[t("div",oe,[a(L,{class:"my-sticky-header-table",rows:o.rows,columns:o.columns,filter:o.filter,loading:o.loading,"row-key":"name"},{top:l(()=>[a(D),a(V,{dense:"",debounce:"300",color:"primary",modelValue:o.filter,"onUpdate:modelValue":s[0]||(s[0]=e=>o.filter=e)},{append:l(()=>[a(b,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-id":l(e=>[a(Q,{props:e},{default:l(()=>[z(I(e.pageIndex+1),1)]),_:2},1032,["props"])]),"body-cell-estado":l(e=>[a(Q,{props:e},{default:l(()=>[e.row.diasPorCaducar<0?(p(),g(v,{key:0,outline:"",color:"red",label:"Vencido",class:"q-pa-sm"})):e.row.diasPorCaducar==0?(p(),g(v,{key:1,outline:"",color:"orange-6",label:"Vence Hoy",class:"q-pa-sm"})):e.row.diasPorCaducar<30&&e.row.diasPorCaducar>0?(p(),g(v,{key:2,outline:"",color:"orange-6",label:"Por caducar",class:"q-pa-sm"})):e.row.diasPorCaducar>30?(p(),g(v,{key:3,outline:"",color:"positive",label:"Proximo a vencer",class:"q-pa-sm"})):E("",!0)]),_:2},1032,["props"])]),"body-cell-acciones":l(e=>[a(Q,{props:e},{default:l(()=>[a(y,{onClick:d=>o.updateDateProduct(e.row),round:"",color:"grey-14",icon:"update",size:"11px"},null,8,["onClick"])]),_:2},1032,["props"])]),"no-data":l(({icon:e,filter:d})=>[t("div",le,[a(b,{size:"2em",name:"sentiment_dissatisfied"}),te,a(b,{size:"2em",name:d?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","columns","filter","loading"])])])])]),_:1}),a(M,{modelValue:o.modalUpdateDate,"onUpdate:modelValue":s[4]||(s[4]=e=>o.modalUpdateDate=e)},{default:l(()=>[a(J,{style:{width:"560px","max-width":"80vw"}},{default:l(()=>[a(P,{class:"row items-center q-pb-none text-center"},{default:l(()=>[se,a(D),k(a(y,{icon:"close",flat:"",round:"",dense:""},null,512),[[U]])]),_:1}),a(P,null,{default:l(()=>[a(R,null,{default:l(()=>[t("div",de,[t("div",re,[ce,a(V,{modelValue:o.productUpdate.producto_update,"onUpdate:modelValue":s[1]||(s[1]=e=>o.productUpdate.producto_update=e),modelModifiers:{trim:!0},dense:"",filled:"",required:"",readonly:""},null,8,["modelValue"])]),ie,a(V,{filled:"",modelValue:o.productUpdate.fecha_caducidad_update,"onUpdate:modelValue":s[3]||(s[3]=e=>o.productUpdate.fecha_caducidad_update=e),dense:"",mask:"date",clearable:"","clear-icon":"close"},{append:l(()=>[a(b,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(O,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(H,{modelValue:o.productUpdate.fecha_caducidad_update,"onUpdate:modelValue":s[2]||(s[2]=e=>o.productUpdate.fecha_caducidad_update=e),locale:o.myLocale},{default:l(()=>[t("div",ne,[k(a(y,{label:"Cerrar",color:"primary",flat:""},null,512),[[U]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",ue,[a(y,{onClick:o.submit,loading:o.loadingUpdate,label:"Actualizar",class:"q-px-xl",color:"green-9"},null,8,["onClick","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var Pe=S(G,[["render",me]]);export{Pe as default};
