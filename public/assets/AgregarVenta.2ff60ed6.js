import{n as _,l as te,bj as oe,bk as le,d as L,r as d,a as E,_ as z,o as C,aa as x,g as r,f as s,aW as P,e as o,h as $,i as F,ac as S,ad as h,aX as ne,u as se,m as re,ae as U,c as Q,aT as B,ag as ie,bh as ce,w as de,Q as D,bi as ue,ab as me,b3 as pe}from"./index.e02e0fd9.js";import{e as fe,d as ge,Q as _e}from"./QList.ffb79e57.js";import{Q as Y,a as A}from"./QTable.7676999b.js";import{Q as ve}from"./QBadge.5c85781b.js";import{Q as be}from"./QForm.0c336d83.js";import{Q as he}from"./QPage.b9acbce1.js";import{u as K,A as N}from"./Api.e3a65a9d.js";import{u as ye,a as Ae}from"./useHelpers.6f57171d.js";import{d as Ce}from"./date.cb1dcd19.js";import{A as we}from"./Add.1abc63ee.js";import{Q as Ie}from"./QInnerLoading.6f65ce49.js";import"./index.2cf0d985.js";const Se=[_("g",{transform:"translate(20 50)"},[_("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.6"},[_("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),_("g",{transform:"translate(50 50)"},[_("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.8"},[_("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),_("g",{transform:"translate(80 50)"},[_("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.9"},[_("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var Ve=te({name:"QSpinnerFacebook",props:oe,setup(e){const{cSize:n,classes:v}=le(e);return()=>_("svg",{class:v.value,width:n.value,height:n.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},Se)}});const Fe=[{name:"add",label:"Agregar",align:"left",field:"add"},{name:"cod_barra",label:"Codigo Barra",align:"left",field:"cod_barra"},{name:"pv_nombre",label:"Punto de Venta",align:"center",field:"pv_nombre"},{name:"producto",label:"Producto",align:"left",field:"producto"},{name:"fxc",label:"F. por Caja",align:"center",field:"fxc"},{name:"cajas",label:"Stock Cajas",align:"center",field:"cajas"},{name:"fracciones",label:"Stock Fracciones",align:"center",field:"fracciones"},{name:"pvp",label:"P. Caja",align:"center",field:"pvp"},{name:"p_unit",label:"P. Unit.",align:"center",field:"p_unit"},{name:"descuento",label:"Descuento",align:"center",field:"descuento"},{name:"iva",label:"IVA",align:"center",field:"aplicaIva"}],xe=L({name:"buscar-producto",props:["productos"],setup(e,{emit:n}){const v=d([]),w=d(!1),y=K(),{claim:{user:b}}=E.read(y.token);e.productos.map(t=>{t.cajas=t.fracciones_total!==0?parseInt(t.fracciones_total/t.fxc):0,t.fracciones=t.fracciones_total!==0?parseInt(t.fracciones_total%t.fxc):0}),v.value=e.productos;let i=0;return b.rol_name=="ADMINISTRADOR"||b.rol_name=="SUPER-ADMINISTRADOR"?i=y.pv_selected_admin:i=b.pv_id,{agregarProducto:t=>{n("addArticle",t)},columns:Fe,loading:w,rows:v,pv_busqueda:i,user:b}}}),ke=o("div",{class:"text-h6 text-center"},"Buscar Producto",-1),Ne={class:"row q-gutter-sm"},$e={class:"col-sm-12 q-my-sm"};function qe(e,n,v,w,y,b){return C(),x(ne,{style:{width:"1040px","max-width":"80vw"}},{default:r(()=>[s(P,{class:"q-pb-none"},{default:r(()=>[ke]),_:1}),s(P,null,{default:r(()=>[o("div",Ne,[o("div",$e,[s(Y,{class:"my-sticky-header-table2",rows:e.rows,columns:e.columns,loading:e.loading,"hide-bottom":"","row-key":"name"},{"body-cell-add":r(i=>[s(A,{props:i},{default:r(()=>[e.pv_busqueda==i.row.pv_id?(C(),x($,{key:0,round:"",color:"green-10",class:"q-ml-md",size:"sm",onClick:m=>e.agregarProducto(i.row),icon:"fa-solid fa-plus"},null,8,["onClick"])):(C(),x(F,{key:1,color:"blue-grey-8",class:"q-ml-md",size:"sm",name:"fa-solid fa-ban"}))]),_:2},1032,["props"])]),"body-cell-descuento":r(i=>[s(A,{props:i},{default:r(()=>[S(h(i.row.descuento)+"% ",1)]),_:2},1032,["props"])]),"body-cell-pvp":r(i=>[s(A,{props:i},{default:r(()=>[S("$"+h(i.row.pvp),1)]),_:2},1032,["props"])]),"body-cell-p_unit":r(i=>[s(A,{props:i},{default:r(()=>[S("$"+h(i.row.p_unit),1)]),_:2},1032,["props"])]),loading:r(()=>[s(Ie,{showing:"",color:"primary"})]),_:1},8,["rows","columns","loading"])])])]),_:1})]),_:1})}var De=z(xe,[["render",qe]]);const Re=[{name:"acciones",label:"Quitar",align:"left"},{name:"cod_barra",label:"Codigo Barra",align:"left",field:"cod_barra"},{name:"producto",label:"Producto",align:"left",field:"producto"},{name:"cantidad",label:"Cajas",align:"center",field:"cantidad"},{name:"f_c",label:"F/C",align:"center",field:"f_c"},{name:"fxc",label:"F. por caja",align:"center",field:"fxc"},{name:"cajas",label:"T. cajas",align:"center",field:"cajas"},{name:"fracciones",label:"T. fracciones",align:"center",field:"fracciones"},{name:"pvp",label:"Precio Venta",align:"center",field:"pvp"},{name:"p_unit",label:"Precio Unitario",align:"center",field:"p_unit"},{name:"descuento",label:"Descuento",align:"center",field:"descuento"},{name:"iva",label:"IVA",align:"center",field:"aplicaIva"},{name:"v_total",label:"Valor Total",align:"center",field:"v_total"}];let j=[];const Te=L({name:"AddVentas",components:{Add:we,Search:De},setup(){const e=d([]),n=d([]),v=d(!0),w=d(!1),y=d(!1),b=d([]),i=d(!1),m=d(!1),{mostrarNotify:t}=ye(),p=Ae();let R="";const G=d({sortBy:"desc",descending:!1,page:1,rowsPerPage:25,rowsNumber:25}),g=d({cliente_id:"CONSUMIDOR FINAL",numComprobante:""}),V=d(""),H=Date.now();R=Ce.formatDate(H,"DD/MM/YYYY");const T=se(),k=K(),{claim:{user:u}}=E.read(k.token),M=a=>{if(a.fracciones_total<1)return m.value=!1,V.value="",t("warning","No hay stock de este producto...");if(e.value.some(c=>c.cod_barra==a.cod_barra))t("warning","Ya fue agregado este articulo");else{const c=a.fracciones_total,f=a.fxc;a.cajas=c!==0?parseInt(c/f):0,a.fracciones=c!==0?parseInt(c%f):0,a.pvp=a.pvp.toFixed(2),a.p_unit=a.p_unit.toFixed(2),a.cant_venta=0,a.f_c=0,a.v_total=0 .toFixed(2),e.value.unshift(a),V.value=""}},W=async()=>{if(V.value.length==0)return t("warning","Ingresa el codigo IMEI");try{m.value=!0;let a=0;u.rol_name=="ADMINISTRADOR"||u.rol_name=="SUPER-ADMINISTRADOR"?a=k.pv_selected_admin:a=u.pv_id;const{data:l}=await N.get(`/articulos/${V.value}/${a}`);if(l.articulo.length>1)return b.value=l.articulo,y.value=!0,m.value=!1;if(l.articulo.length==0)return m.value=!1,t("warning","No se encontro el articulo...");M(l.articulo[0]),m.value=!1}catch(a){console.log(a),m.value=!1}},X=a=>{M(a),y.value=!1},J=a=>{let l=a.fxc*a.cant_venta+parseInt(a.f_c);if(a.f_c>=a.fxc){const c=parseInt(l/a.fxc),f=l%a.fxc;a.cant_venta=c,a.f_c=f}a.v_total=(l*a.p_unit).toFixed(2)},Z=a=>{const l=e.value.findIndex(c=>c.id==a);e.value.splice(l,1)},ee=async()=>{i.value=!0;let a=0;u.rol_name=="ADMINISTRADOR"||u.rol_name=="SUPER-ADMINISTRADOR"?a=k.pv_selected_admin:a=u.pv_id;try{const{data:{numeroSecuencial:l}}=await N.get(`/ventas/getNoFactura/${a}`);g.value.numComprobante=l}catch(l){console.log(l)}i.value=!1},O=async()=>{w.value=!1;try{const{data:{clientes:a}}=await N.get("/clientes");n.value=[],a.forEach(l=>{l.nombres!="CONSUMIDOR FINAL"&&n.value.push({label:l.nombres,value:l.id,cedula:l.num_documento})}),n.value.push({label:"CONSUMIDOR FINAL",value:0,cedula:"0"}),j=n.value}catch(a){console.log(a)}},q=re(()=>{let a=0,l=0,c=0,f=0;return e.value.forEach(I=>{I.aplicaIva=="SI"&&(l+=parseFloat(I.v_total)*.12),I.descuento>0&&(c+=I.v_total*I.descuento/100),a+=parseFloat(I.v_total)}),f=a+l-c,{subtotal:a.toFixed(2),iva:l.toFixed(2),descuento:c.toFixed(2),total:f.toFixed(2)}}),ae=async()=>{if(e.value.length==0)return t("warning","Debes agregar algun producto..");if(parseFloat(q.value.total)>50&&g.value.cliente_id=="CONSUMIDOR FINAL")return t("warning","No es posible emitir factura que superen $50 como CONSUMIDOR FINAL");e.value.forEach((l,c)=>{if(l.fxc*l.cant_venta+parseInt(l.f_c)>l.fracciones_total){t("negative",`la cantidad de venta del articulo ${l.producto} es superior al stock disponible`);return}});let a=0;u.rol_name=="ADMINISTRADOR"||u.rol_name=="SUPER-ADMINISTRADOR"?a=k.pv_selected_admin:a=u.pv_id,g.value.usuario_id=u.id,g.value.usuario_name=`${u.nombres.split(" ")[0]} ${u.apellidos}`,g.value.pv_id=a,g.value.detalle=e.value,g.value.valoresFactura=q.value,g.value.imprimir=v.value;try{p.dialog({title:"\xBFDeseas Agregar esta Venta?",ok:{push:!0,label:"Agregar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{p.loading.show({message:"Cargando..."}),await N.post("/ventas/add",g.value),p.loading.hide(),t("positive","Venta realizado exitosamente"),T.push("/ventas")})}catch(l){console.log(l),p.loading.hide()}};return ee(),O(),{addArticle:X,calcularCostoVentaProducto:J,columns:Re,formVenta:g,fechaActual:R,filterByCodBarra:V,imprimir:v,filterArticulo:W,listClientes:n,loadingState:m,getClientes:O,modalAgregarCliente:w,modalBuscarProducto:y,numFacturaCargado:i,productos:b,rows:e,valorFactura:q,pagination:G,router:T,filterFn(a,l){if(a===""){l(()=>{n.value=j});return}l(()=>{const c=a.toLowerCase();n.value=n.value.filter(f=>f.cedula.indexOf(c)>-1||f.label.toLowerCase().indexOf(c)>-1)})},onSubmit:ae,quitarArticulo:Z}}}),Me={class:"row q-my-lg q-pl-md"},Oe={class:"col-md-6"},Pe={class:"text-h5 text-weight-medium"},Ue={class:"text-weight-regular"},Qe={class:"col-md-6 text-right"},Be={class:"q-mr-lg text-h5 text-weight-medium"},je=o("span",{class:"q-mr-sm"},"N\xB0 Factura:",-1),Le={key:1,class:"text-weight-regular"},Ee={class:"col-md-5 q-mt-md"},ze=o("label",null,"Seleccionar Cliente: ",-1),Ye={class:"col-md-4 q-mt-lg btnAddCliente"},Ke={class:"row q-mt-lg q-mb-xs q-pl-md"},Ge={class:"col-md-5"},He=o("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),We={class:"row"},Xe={class:"col-md-12"},Je={class:"q-px-md"},Ze={class:"full-width row flex-center text-lime-10 q-gutter-sm"},ea=o("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),aa={class:"col-md-12",style:{display:"flex","justify-content":"space-between"}},ta={style:{"margin-right":"30px"}},oa={class:"text-right"},la=o("td",null,[o("b",null,"SUBTOTAL:")],-1),na={style:{width:"90px"},class:"text-subtitle1 text-weight-regular"},sa={class:"text-right"},ra=o("td",{class:"q-py-sm"},[o("b",null,"IVA(12%):")],-1),ia={style:{width:"90px"},class:"q-py-sm text-subtitle1 text-weight-regular"},ca={class:"text-right"},da=o("td",{class:"q-py-sm"},[o("b",null,"TOTAL DESCUENTO:")],-1),ua={style:{width:"90px"},class:"q-py-sm text-subtitle1 text-weight-regular"},ma={class:"text-right"},pa=o("td",null,[o("b",null,"TOTAL A PAGAR:")],-1),fa={style:{width:"90px"}},ga={class:"col-md-4 offset-4"};function _a(e,n,v,w,y,b){const i=U("Add"),m=U("Search");return C(),Q(ie,null,[s(he,null,{default:r(()=>[o("div",Me,[o("div",Oe,[o("label",Pe,[S("Fecha de Emisi\xF3n: "),o("span",Ue,h(e.fechaActual),1)])]),o("div",Qe,[o("label",Be,[je,e.numFacturaCargado?(C(),x(Ve,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(C(),Q("span",Le,h(e.formVenta.numComprobante),1))])]),o("div",Ee,[ze,s(fe,{color:"orange",filled:"",modelValue:e.formVenta.cliente_id,"onUpdate:modelValue":n[1]||(n[1]=t=>e.formVenta.cliente_id=t),options:e.listClientes,"emit-value":"","map-options":"",onFilter:e.filterFn,"use-input":"","input-debounce":"0"},ce({"no-option":r(()=>[s(ge,null,{default:r(()=>[s(_e,{class:"text-grey"},{default:r(()=>[S(" No hay resultados ")]),_:1})]),_:1})]),_:2},[e.formVenta.cliente_id&&e.formVenta.cliente_id!=="CONSUMIDOR FINAL"?{name:"append",fn:r(()=>[s(F,{name:"cancel",onClick:n[0]||(n[0]=de(t=>e.formVenta.cliente_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","onFilter"])]),o("div",Ye,[s($,{round:"",color:"primary",onClick:n[2]||(n[2]=t=>e.modalAgregarCliente=!0),icon:"person_add"})])]),o("div",Ke,[o("div",Ge,[He,s(D,{outlined:"","bottom-slots":"",loading:e.loadingState,modelValue:e.filterByCodBarra,"onUpdate:modelValue":n[4]||(n[4]=t=>e.filterByCodBarra=t),modelModifiers:{trim:!0},onKeyup:ue(e.filterArticulo,["enter"])},{append:r(()=>[e.filterByCodBarra!==""?(C(),x(F,{key:0,name:"close",onClick:n[3]||(n[3]=t=>e.filterByCodBarra=""),class:"cursor-pointer"})):me("",!0),s(F,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])]),s(be,{onSubmit:e.onSubmit},{default:r(()=>[o("div",We,[o("div",Xe,[o("div",Je,[s(Y,{rows:e.rows,columns:e.columns,pagination:e.pagination,"onUpdate:pagination":n[5]||(n[5]=t=>e.pagination=t),"row-key":"name",class:"my-sticky-header-table3"},{"no-data":r(({})=>[o("div",Ze,[ea,s(F,{size:"2em",name:"playlist_add"})])]),"body-cell-descuento":r(t=>[s(A,{props:t},{default:r(()=>[S(h(t.row.descuento)+"% ",1)]),_:2},1032,["props"])]),"body-cell-cantidad":r(t=>[s(A,{props:t},{default:r(()=>[s(D,{"input-class":"resaltarTextoInput",dense:"",required:"",max:t.row.cajas,onChange:p=>e.calcularCostoVentaProducto(t.row),min:"0",type:"number",style:{width:"100px"},modelValue:t.row.cant_venta,"onUpdate:modelValue":p=>t.row.cant_venta=p,modelModifiers:{trim:!0}},null,8,["max","onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-f_c":r(t=>[s(A,{props:t},{default:r(()=>[s(D,{"input-class":"resaltarTextoInput",dense:"",required:"",min:"0",onChange:p=>e.calcularCostoVentaProducto(t.row),disable:t.row.fxc==1,type:"number",style:{width:"100px"},modelValue:t.row.f_c,"onUpdate:modelValue":p=>t.row.f_c=p,modelModifiers:{trim:!0}},null,8,["onChange","disable","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":r(t=>[s(A,{props:t},{default:r(()=>[s($,{round:"",color:"deep-orange",onClick:p=>e.quitarArticulo(t.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])])]),o("div",aa,[o("div",null,[s(pe,{modelValue:e.imprimir,"onUpdate:modelValue":n[6]||(n[6]=t=>e.imprimir=t),label:"IMPRIMIR FACTURA",color:"primary",size:"lg",class:"q-ml-lg q-mt-lg"},null,8,["modelValue"])]),o("table",ta,[o("tr",oa,[la,o("td",na," $"+h(e.valorFactura.subtotal),1)]),o("tr",sa,[ra,o("td",ia," $"+h(e.valorFactura.iva),1)]),o("tr",ca,[da,o("td",ua," $"+h(e.valorFactura.descuento),1)]),o("tr",ma,[pa,o("td",fa,[s(ve,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${e.valorFactura.total}`},null,8,["label"])])])])]),o("div",ga,[s($,{square:"",color:"green-10",type:"submit",label:"Agregar Venta",class:"full-width",icon:"shopping_cart"})])])]),_:1},8,["onSubmit"])]),_:1}),s(B,{modelValue:e.modalAgregarCliente,"onUpdate:modelValue":n[7]||(n[7]=t=>e.modalAgregarCliente=t)},{default:r(()=>[s(i,{onActualizarLista:e.getClientes},null,8,["onActualizarLista"])]),_:1},8,["modelValue"]),s(B,{modelValue:e.modalBuscarProducto,"onUpdate:modelValue":n[8]||(n[8]=t=>e.modalBuscarProducto=t)},{default:r(()=>[s(m,{productos:e.productos,onAddArticle:e.addArticle},null,8,["productos","onAddArticle"])]),_:1},8,["modelValue"])],64)}var ka=z(Te,[["render",_a]]);export{ka as default};
