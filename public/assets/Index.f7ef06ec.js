import{d as I,r as t,a as M,C as z,_ as N,o as w,aa as C,g as i,f as a,aW as E,e as l,Q as c,i as _,h as q,aX as W,ae as L,c as O,ab as Q,aT as j,ag as B,bg as Y,aV as Z,ac as F,ad as G}from"./index.e02e0fd9.js";import{Q as x}from"./QSpace.290b7cf2.js";import{Q as ee,a as A}from"./QTable.7676999b.js";import{Q as H}from"./QBadge.5c85781b.js";import{Q as oe}from"./QPage.b9acbce1.js";import{Q as le}from"./QPageSticky.51a05daf.js";import{u as T,A as V}from"./Api.e3a65a9d.js";import{e as S}from"./QList.ffb79e57.js";import{Q as X}from"./QForm.0c336d83.js";import{a as J,u as se}from"./useHelpers.6f57171d.js";import{u as ae}from"./useRolPermisos.82749469.js";import"./index.2cf0d985.js";const re=I({name:"AgregarUsuario",setup(e,{emit:o}){const m=t({rol_id:"",pv_id:"",nombres:"",apellidos:"",cedula:"",celular:"",email:"",password:"",confirmPassword:""}),f=t([]),v=t(!1),g=t([]),s=J(),P=T(),{claim:{user:r}}=M.read(P.token),y=async()=>{try{const{data:{roles:n}}=await V.get("/roles");f.value=[],n.forEach(p=>{r.rol_name!="SUPER-ADMINISTRADOR"?p.nombre!="SUPER-ADMINISTRADOR"&&f.value.push({label:p.nombre,value:p.id}):f.value.push({label:p.nombre,value:p.id})})}catch(n){console.log(n)}},h=async()=>{try{const{data:{puntos_ventas:n}}=await V.get("/puntos_ventas/true");g.value=[],n.forEach(p=>{g.value.push({label:p.nombre,value:p.id})})}catch(n){console.log(n)}};y(),h();const u=async()=>{if(m.value.password!==m.value.confirmPassword)return alert("Las contrase\xF1as no son iguales");try{v.value=!0,await V.post("/usuarios",m.value),o("actualizarLista"),s.notify({color:"positive",message:"Usuario Agregado Exitosamente",icon:"done"}),v.value=!1}catch(n){v.value=!1,s.notify({color:"warning",message:n.response.data.errors[0].msg,position:"top-right"})}};return z(m.value,(n,p)=>{m.value.nombres=n.nombres.toUpperCase(),m.value.apellidos=n.apellidos.toUpperCase()}),{listRoles:f,listPuntosVentas:g,loading:v,formUsuario:m,onSubmit:u,isPwd:t(!0),isPwd2:t(!0)}}}),ie=l("div",{class:"text-h6"},"Agregar Usuario",-1),te={class:"row q-gutter-sm justify-around"},ne={class:"col-xs-12 col-sm-5"},de=l("label",null,"Nombres:",-1),ue={class:"col-xs-12 col-sm-5"},me=l("label",null,"Apellidos:",-1),pe={class:"col-xs-12 col-sm-5 q-my-md"},ce=l("label",null,"Cedula:",-1),fe={class:"col-xs-12 col-sm-5 q-my-md"},ve=l("label",null,"Celular:",-1),Ue={class:"col-xs-12 col-sm-5 q-my-md"},be=l("label",null,"Email:",-1),ge={class:"col-xs-12 col-sm-5 q-my-md"},ye=l("label",null,"Rol:",-1),we={class:"col-xs-12 col-sm-5 q-my-md"},Ve=l("label",null,"Contrase\xF1a:",-1),$e={class:"col-xs-12 col-sm-5 q-my-md"},Pe=l("label",null,"Confirmar Contrase\xF1a:",-1),he={class:"col-xs-12 col-sm-5 q-my-md"},Ce=l("label",null,"Punto de Venta:",-1),qe={class:"col-xs-9 col-sm-12 flex justify-center"};function _e(e,o,m,f,v,g){return w(),C(W,{style:{width:"700px","max-width":"80vw"}},{default:i(()=>[a(E,null,{default:i(()=>[ie]),_:1}),a(E,null,{default:i(()=>[a(X,{onSubmit:e.onSubmit},{default:i(()=>[l("div",te,[l("div",ne,[de,a(c,{modelValue:e.formUsuario.nombres,"onUpdate:modelValue":o[0]||(o[0]=s=>e.formUsuario.nombres=s),dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",ue,[me,a(c,{modelValue:e.formUsuario.apellidos,"onUpdate:modelValue":o[1]||(o[1]=s=>e.formUsuario.apellidos=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",pe,[ce,a(c,{modelValue:e.formUsuario.cedula,"onUpdate:modelValue":o[2]||(o[2]=s=>e.formUsuario.cedula=s),modelModifiers:{trim:!0},minlength:"10",maxlength:"10",type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",fe,[ve,a(c,{modelValue:e.formUsuario.celular,"onUpdate:modelValue":o[3]||(o[3]=s=>e.formUsuario.celular=s),modelModifiers:{trim:!0},type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Ue,[be,a(c,{modelValue:e.formUsuario.email,"onUpdate:modelValue":o[4]||(o[4]=s=>e.formUsuario.email=s),modelModifiers:{trim:!0},type:"email",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",ge,[ye,a(S,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.rol_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e.formUsuario.rol_id=s),options:e.listRoles},null,8,["modelValue","options"])]),l("div",we,[Ve,a(c,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.password,"onUpdate:modelValue":o[7]||(o[7]=s=>e.formUsuario.password=s),modelModifiers:{trim:!0},type:e.isPwd?"password":"text",required:""},{append:i(()=>[a(_,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[6]||(o[6]=s=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",$e,[Pe,a(c,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.confirmPassword,"onUpdate:modelValue":o[9]||(o[9]=s=>e.formUsuario.confirmPassword=s),modelModifiers:{trim:!0},type:e.isPwd2?"password":"text",required:""},{append:i(()=>[a(_,{name:e.isPwd2?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[8]||(o[8]=s=>e.isPwd2=!e.isPwd2)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",he,[Ce,a(S,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.pv_id,"onUpdate:modelValue":o[10]||(o[10]=s=>e.formUsuario.pv_id=s),options:e.listPuntosVentas},null,8,["modelValue","options"])]),l("div",qe,[a(q,{label:"Guardar",class:"q-px-xl",loading:e.loading,type:"submit",color:"green-9"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var ke=N(re,[["render",_e]]);const Ae=I({name:"EditarUsuario",props:["userData"],setup(e,{emit:o}){const{id:m,nombres:f,apellidos:v,cedula:g,celular:s,email:P,rol_id:r,pv_id:y}=e.userData,h=t(!1),u=t({rol_id:"",pv_id:y,nombres:f,apellidos:v,cedula:g,celular:s,email:P,password:"",confirmPassword:""}),n=t([]),p=t([]),k=J(),R=T(),{claim:{user:d}}=M.read(R.token),U=async()=>{try{const{data:{roles:b}}=await V.get("/roles");n.value=[],b.forEach($=>{d.rol_name!="SUPER-ADMINISTRADOR"?$.nombre!="SUPER-ADMINISTRADOR"&&n.value.push({label:$.nombre,value:$.id}):n.value.push({label:$.nombre,value:$.id})}),u.value.rol_id=r}catch(b){console.log(b)}},D=async()=>{try{const{data:{puntos_ventas:b}}=await V.get("/puntos_ventas/true");p.value=[],b.forEach($=>{p.value.push({label:$.nombre,value:$.id})})}catch(b){console.log(b)}};U(),D();const K=async()=>{if(u.value.password.length!==0&&u.value.password!==u.value.confirmPassword)return alert("Las contrase\xF1as no son iguales");try{h.value=!0,await V.put(`/usuarios/${m}`,u.value),o("actualizarLista"),k.notify({color:"positive",message:"Usuario Editado Exitosamente",icon:"done"}),h.value=!1}catch(b){h.value=!1,k.notify({color:"warning",message:b.response.data.errors[0].msg,position:"top-right"})}};return z(u.value,(b,$)=>{u.value.nombres=b.nombres.toUpperCase(),u.value.apellidos=b.apellidos.toUpperCase()}),{listRoles:n,listPuntosVentas:p,loading:h,formUsuario:u,onSubmit:K,isPwd:t(!0),isPwd2:t(!0)}}}),Ee=l("div",{class:"text-h6"},"Editar Usuario",-1),Se={class:"row q-gutter-sm justify-around"},Re={class:"col-xs-12 col-sm-5"},De=l("label",null,"Nombres:",-1),Qe={class:"col-xs-12 col-sm-5"},Ie=l("label",null,"Apellidos:",-1),Me={class:"col-xs-12 col-sm-5 q-my-md"},ze=l("label",null,"Cedula:",-1),Ne={class:"col-xs-12 col-sm-5 q-my-md"},Te=l("label",null,"Celular:",-1),Le={class:"col-xs-12 col-sm-5 q-my-md"},Oe=l("label",null,"Email:",-1),je={class:"col-xs-12 col-sm-5 q-my-md"},Be=l("label",null,"Rol:",-1),Fe={class:"col-xs-12 col-sm-5 q-my-md"},Ge=l("label",null,"Cambiar Contrase\xF1a (Opcional):",-1),He={class:"col-xs-12 col-sm-5 q-my-md"},We=l("label",null,"Confirmar Contrase\xF1a:",-1),Xe={class:"col-xs-12 col-sm-5 q-my-md"},Je=l("label",null,"Punto de Venta:",-1),Ke={class:"col-xs-9 col-sm-12 flex justify-center"};function Ye(e,o,m,f,v,g){return w(),C(W,{style:{width:"700px","max-width":"80vw"}},{default:i(()=>[a(E,null,{default:i(()=>[Ee]),_:1}),a(E,null,{default:i(()=>[a(X,{onSubmit:e.onSubmit},{default:i(()=>[l("div",Se,[l("div",Re,[De,a(c,{modelValue:e.formUsuario.nombres,"onUpdate:modelValue":o[0]||(o[0]=s=>e.formUsuario.nombres=s),dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Qe,[Ie,a(c,{modelValue:e.formUsuario.apellidos,"onUpdate:modelValue":o[1]||(o[1]=s=>e.formUsuario.apellidos=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Me,[ze,a(c,{modelValue:e.formUsuario.cedula,"onUpdate:modelValue":o[2]||(o[2]=s=>e.formUsuario.cedula=s),modelModifiers:{trim:!0},minlength:"10",maxlength:"10",type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Ne,[Te,a(c,{modelValue:e.formUsuario.celular,"onUpdate:modelValue":o[3]||(o[3]=s=>e.formUsuario.celular=s),modelModifiers:{trim:!0},type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Le,[Oe,a(c,{modelValue:e.formUsuario.email,"onUpdate:modelValue":o[4]||(o[4]=s=>e.formUsuario.email=s),modelModifiers:{trim:!0},type:"email",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",je,[Be,a(S,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.rol_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e.formUsuario.rol_id=s),options:e.listRoles},null,8,["modelValue","options"])]),l("div",Fe,[Ge,a(c,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.password,"onUpdate:modelValue":o[7]||(o[7]=s=>e.formUsuario.password=s),modelModifiers:{trim:!0},type:e.isPwd?"password":"text"},{append:i(()=>[a(_,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[6]||(o[6]=s=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",He,[We,a(c,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.confirmPassword,"onUpdate:modelValue":o[9]||(o[9]=s=>e.formUsuario.confirmPassword=s),modelModifiers:{trim:!0},type:e.isPwd2?"password":"text"},{append:i(()=>[a(_,{name:e.isPwd2?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[8]||(o[8]=s=>e.isPwd2=!e.isPwd2)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",Xe,[Je,a(S,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.pv_id,"onUpdate:modelValue":o[10]||(o[10]=s=>e.formUsuario.pv_id=s),options:e.listPuntosVentas},null,8,["modelValue","options"])]),l("div",Ke,[a(q,{label:"Editar",class:"q-px-xl",loading:e.loading,type:"submit",color:"green-9"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var Ze=N(Ae,[["render",Ye]]);const xe=[{name:"id",label:"#",align:"left",field:"id",sortable:!0},{name:"usuario",label:"Usuario",align:"left",field:"usuario",sortable:!0},{name:"rol",align:"center",label:"Rol",field:"rol"},{name:"pv",align:"center",label:"Punto de Venta",field:"punto_venta"},{name:"email",label:"Email",field:"email",align:"center"},{name:"cedula",label:"Cedula",field:"cedula",align:"center"},{name:"celular",label:"Celular",field:"celular",align:"center"},{name:"estado",label:"Estado",align:"center",field:"estado"},{name:"acciones",label:"acciones",align:"center"}],eo=I({name:"IndexUsuario",components:{AgregarUsuario:ke,EditarUsuario:Ze},setup(){const{validarPermisos:e}=ae(),o=t(""),m=t([]),f=t(!0),{mostrarNotify:v}=se(),g=t(!1),s=t(!1),P=t({}),r=t({nombres:"",apellidos:"",cedula:"",celular:"",email:"",password:""}),y=T(),{claim:{user:h}}=M.read(y.token),u=async()=>{g.value=!1,s.value=!1,f.value=!0;try{let{data:{usuarios:d}}=await V.get("/usuarios");d.map(U=>U.usuario=`${U.nombres} ${U.apellidos}`),h.rol_name!="SUPER-ADMINISTRADOR"&&(d=d.filter(U=>U.rol!="SUPER-ADMINISTRADOR")),m.value=d}catch(d){console.log(d)}f.value=!1};u();const n=async(d,U)=>{try{await V.delete(`/usuarios/${d}/${U}`),v("positive",`Usuario ${U?"Activado":"Inactivado"} exitosamente`),u()}catch(D){console.log(D)}},p=async d=>{Y.create({title:"\xBFDeseas Eliminar a este usuario?",message:"Una vez eliminado no podra recuperarse...!",ok:{push:!0,label:"Eliminar",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{await V.delete(`/usuarios/${d}`),v("positive","Usuario eliminado exitosamente"),u()}catch(U){v("negative",U.response.data.message)}})},k=async()=>{const d=await V.post("/usuarios",r.value);console.log(d)},R=d=>{P.value=d,s.value=!0};return z(r.value,(d,U)=>{r.value.nombres=d.nombres.toUpperCase(),r.value.apellidos=d.apellidos.toUpperCase()}),{editarUsuario:R,eliminarUsuario:p,modalCrearUsuario:g,modalEditarUsuario:s,activarDesactivarUser:n,columns:xe,formUsuario:r,filter:o,loading:f,getUsuarios:u,onSubmit:k,isPwd:t(!0),rows:m,userData:P,validarPermisos:e}}}),oo=l("div",{class:"col-md-6"},[l("label",{class:"text-h6"},"Listado de Usuarios")],-1),lo={class:"col-md-6 flex justify-end"},so={class:"row"},ao={class:"col-md-12 col-xs-12"},ro={class:"q-pa-md"},io={class:"full-width row flex-center text-lime-10 q-gutter-sm"},to=l("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1);function no(e,o,m,f,v,g){const s=L("AgregarUsuario"),P=L("EditarUsuario");return w(),O(B,null,[a(oe,null,{default:i(()=>[l("div",{class:Z(["row q-py-lg q-pl-md",e.$q.screen.xs?"justify-center":"justify-between"])},[oo,l("div",lo,[e.validarPermisos("Agregar Usuario")&&!e.$q.screen.xs?(w(),C(q,{key:0,color:"secondary","icon-right":"person_add",label:"Agregar Usuario",class:"q-mr-md",onClick:o[0]||(o[0]=r=>e.modalCrearUsuario=!e.modalCrearUsuario)})):Q("",!0)])],2),l("div",so,[l("div",ao,[l("div",ro,[a(ee,{class:"my-sticky-header-table",rows:e.rows,columns:e.columns,loading:e.loading,filter:e.filter,"row-key":"name"},{top:i(()=>[a(x),a(c,{dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=r=>e.filter=r),label:"Buscar Usuario"},{append:i(()=>[a(_,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-id":i(r=>[a(A,{props:r},{default:i(()=>[F(G(r.pageIndex+1),1)]),_:2},1032,["props"])]),"body-cell-pv":i(r=>[a(A,{props:r},{default:i(()=>[F(G(r.row.punto_venta),1)]),_:2},1032,["props"])]),"body-cell-estado":i(r=>[a(A,{props:r},{default:i(()=>[r.value?(w(),C(H,{key:0,outline:"",color:"positive",label:"Activo",class:"q-pa-sm"})):(w(),C(H,{key:1,outline:"",color:"red",label:"Inactivo",class:"q-pa-sm"}))]),_:2},1032,["props"])]),"body-cell-acciones":i(r=>[a(A,{props:r},{default:i(()=>[e.validarPermisos("Editar Usuario")&&r.row.estado?(w(),C(q,{key:0,round:"",color:"primary",onClick:y=>e.editarUsuario(r.row),icon:"edit",class:"q-mr-sm",size:"11px"},null,8,["onClick"])):Q("",!0),r.row.estado?(w(),C(q,{key:1,round:"",color:"blue-grey",icon:"close",onClick:y=>e.activarDesactivarUser(r.row.id,!1),size:"11px"},null,8,["onClick"])):(w(),O(B,{key:2},[a(q,{round:"",color:"positive",class:"q-mr-sm",icon:"done",onClick:y=>e.activarDesactivarUser(r.row.id,!0),size:"11px"},null,8,["onClick"]),a(q,{round:"",color:"deep-orange",icon:"delete",onClick:y=>e.eliminarUsuario(r.row.id),size:"11px"},null,8,["onClick"])],64))]),_:2},1032,["props"])]),"no-data":i(({icon:r,filter:y})=>[l("div",io,[a(_,{size:"2em",name:"sentiment_dissatisfied"}),to,a(_,{size:"2em",name:y?"filter_b_and_w":r},null,8,["name"])])]),_:1},8,["rows","columns","loading","filter"])])])])]),_:1}),e.$q.screen.xs&&e.validarPermisos("Agregar Usuario")?(w(),C(le,{key:0,position:"bottom-right",offset:[18,18]},{default:i(()=>[a(q,{round:"",color:"secondary",size:"lg",icon:"add",onClick:o[2]||(o[2]=r=>e.modalCrearUsuario=!e.modalCrearUsuario)})]),_:1})):Q("",!0),a(j,{modelValue:e.modalCrearUsuario,"onUpdate:modelValue":o[3]||(o[3]=r=>e.modalCrearUsuario=r)},{default:i(()=>[a(s,{onActualizarLista:e.getUsuarios},null,8,["onActualizarLista"])]),_:1},8,["modelValue"]),a(j,{modelValue:e.modalEditarUsuario,"onUpdate:modelValue":o[4]||(o[4]=r=>e.modalEditarUsuario=r)},{default:i(()=>[a(P,{userData:e.userData,onActualizarLista:e.getUsuarios},null,8,["userData","onActualizarLista"])]),_:1},8,["modelValue"])],64)}var $o=N(eo,[["render",no]]);export{$o as default};
