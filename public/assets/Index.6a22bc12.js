import{d as x,r as c,_ as P,o as v,aa as $,g as l,f as a,aW as I,e as o,ad as _,ac as D,aX as W,c as z,i as b,Y as N,h as C,Q,bh as X,w as Y,ab as A,u as G,a as K,C as Z,ae as R,aT as ee,ag as ae}from"./index.e02e0fd9.js";import{Q as oe}from"./QSpace.290b7cf2.js";import{Q as L,a as w}from"./QTable.7676999b.js";import{Q as E}from"./QBadge.5c85781b.js";import{Q as le}from"./QPage.b9acbce1.js";import{Q as te}from"./QPageSticky.51a05daf.js";import{A as F,u as O}from"./Api.e3a65a9d.js";import{u as se}from"./useRolPermisos.82749469.js";import{u as B,a as re}from"./useHelpers.6f57171d.js";import{Q as ne}from"./QInnerLoading.6f65ce49.js";import{Q as T,a as M,C as U}from"./ClosePopup.a58b803f.js";import{Q as ie,d as me,e as de}from"./QList.ffb79e57.js";import"./index.2cf0d985.js";import"./date.cb1dcd19.js";const ce=[{name:"cod_barra",label:"Codigo Barra",align:"left",field:"cod_barra"},{name:"producto",label:"Producto",align:"left",field:"producto"},{name:"cajas",label:"Cajas Comprada",align:"center",field:"cajas"},{name:"fracciones",label:"Fracciones Compradas",align:"center",field:"fracciones"},{name:"v_total",label:"SubTotal",align:"center",field:"total"}],ue=x({name:"detalleCompra",props:["compraData"],setup(e){const s=c([]),m=c(!1);return(async()=>{try{m.value=!0;const{data:i}=await F.get(`/compras/${e.compraData.id}`);s.value=i.detalleCompras,m.value=!1}catch(i){m.value=!1,console.log(i)}})(),{columns:ce,loading:m,rows:s}}}),pe=o("div",{class:"text-h6 text-center"},"Detalle de la Factura",-1),fe={class:"row q-gutter-sm"},_e=o("div",{class:"col-sm-5 text-right"},[o("label",{class:"text-subtitle1 text-weight-medium"},"Usuario:")],-1),ge={class:"col-sm-5 q-ml-lg q-mt-sm flex items-center"},he=o("div",{class:"col-sm-5 text-right q-mt-none"},[o("label",{class:"text-subtitle1 text-weight-medium"},"Proveedor:")],-1),ve={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},be=o("div",{class:"col-sm-5 text-right q-mt-none"},[o("label",{class:"text-subtitle1 text-weight-medium"},"Num. Comprobante:")],-1),Ce={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},ye=o("div",{class:"col-sm-5 text-right q-mt-none"},[o("label",{class:"text-subtitle1 text-weight-medium"},"Descripci\xF3n:")],-1),$e={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},we=o("div",{class:"col-sm-5 text-right q-mt-none"},[o("label",{class:"text-subtitle1 text-weight-medium"},"Fecha/Hora:")],-1),De={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},Fe=o("div",{class:"col-sm-5 text-right q-mt-none"},[o("label",{class:"text-subtitle1 text-weight-medium"},"Total de Pago:")],-1),qe={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},Ve={class:"col-sm-12 q-my-sm"};function Ae(e,s,m,d,i,u){return v(),$(W,{style:{width:"840px","max-width":"80vw"}},{default:l(()=>[a(I,{class:"q-pb-none"},{default:l(()=>[pe]),_:1}),a(I,null,{default:l(()=>[o("div",fe,[_e,o("div",ge,[o("label",null,_(e.compraData.usuario),1)]),he,o("div",ve,[o("label",null,_(e.compraData.proveedor),1)]),be,o("div",Ce,[o("label",null,_(e.compraData.num_comprobante),1)]),ye,o("div",$e,[o("label",null,_(e.compraData.descripcion),1)]),we,o("div",De,[o("label",null,_(e.compraData.fecha),1)]),Fe,o("div",qe,[a(E,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${e.compraData.total.toFixed(2)}`},null,8,["label"])]),o("div",Ve,[a(L,{class:"my-sticky-header-table2",rows:e.rows,columns:e.columns,loading:e.loading,"hide-bottom":"","row-key":"name"},{"body-cell-indice":l(r=>[a(w,{props:r},{default:l(()=>[D(_(r.pageIndex+1),1)]),_:2},1032,["props"])]),"body-cell-v_total":l(r=>[a(w,{props:r},{default:l(()=>[D("$"+_(r.row.total.toFixed(2)),1)]),_:2},1032,["props"])]),loading:l(()=>[a(ne,{showing:"",color:"primary"})]),_:1},8,["rows","columns","loading"])])])]),_:1})]),_:1})}var Se=P(ue,[["render",Ae]]);const ke=x({name:"FiltrarVentas",props:["user","formFiltrarCompras"],setup(e,{emit:s}){const m=O(),d=c([]),i=c(!1),{mostrarNotify:u}=B(),r=async()=>{try{const{data:{pv:t}}=await F.get("/ventas/getPV");d.value=[],t.forEach(p=>{d.value.push({label:p.nombre,value:p.id})})}catch(t){console.log(t)}},y=async()=>{if(e.formFiltrarCompras.desde!=""&&e.formFiltrarCompras.hasta==""||e.formFiltrarCompras.desde==""&&e.formFiltrarCompras.hasta!="")return u("warning","Completa los campos de fecha de busqueda");if(e.formFiltrarCompras.desde>e.formFiltrarCompras.hasta)return u("warning","Error en el rango de fecha de busqueda");i.value=!0;try{e.formFiltrarCompras.pv_id==""&&(e.user.rol_name=="ADMINISTRADOR"||e.user.rol_name=="SUPER-ADMINISTRADOR"?e.formFiltrarCompras.pv_id=m.pv_selected_admin:e.formFiltrarCompras.pv_id=e.user.pv_id);const{data:t}=await F.post("/compras/consulta",e.formFiltrarCompras);s("actualizarLista",t)}catch(t){console.log(t)}i.value=!1};return r(),{listPV:d,loading:i,filtarVentas:y,myLocale:{days:"Domingo_Lunes_Martes_Mi\xE9rcoles_Jueves_Viernes_S\xE1bado".split("_"),daysShort:"Dom_Lun_Mar_Mi\xE9_Jue_Vie_S\xE1b".split("_"),months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),monthsShort:"Ene_Feb_Mar_Abr_May_Jun_Jul_Ago_Sep_Oct_Nov_Dic".split("_"),firstDayOfWeek:1,format24h:!0,pluralDay:"dias"}}}}),Qe={class:"col-md-9 flex items-center"},xe=o("label",null,"Filtrar Por:",-1),Pe={class:"row items-center justify-end"},Ie=o("label",{class:"q-mx-md"},"HASTA:",-1),Ne={class:"row items-center justify-end"};function Re(e,s,m,d,i,u){return v(),z("div",Qe,[xe,a(Q,{class:"q-ml-md",style:{width:"20%"},filled:"",modelValue:e.formFiltrarCompras.desde,"onUpdate:modelValue":s[1]||(s[1]=r=>e.formFiltrarCompras.desde=r),dense:"",mask:"date",clearable:"","clear-icon":"close"},{append:l(()=>[a(b,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(M,{modelValue:e.formFiltrarCompras.desde,"onUpdate:modelValue":s[0]||(s[0]=r=>e.formFiltrarCompras.desde=r),locale:e.myLocale},{default:l(()=>[o("div",Pe,[N(a(C,{label:"Cerrar",color:"primary",flat:""},null,512),[[U]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),Ie,a(Q,{filled:"",style:{width:"20%"},modelValue:e.formFiltrarCompras.hasta,"onUpdate:modelValue":s[3]||(s[3]=r=>e.formFiltrarCompras.hasta=r),dense:"",mask:"date",clearable:"","clear-icon":"close"},{append:l(()=>[a(b,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(M,{modelValue:e.formFiltrarCompras.hasta,"onUpdate:modelValue":s[2]||(s[2]=r=>e.formFiltrarCompras.hasta=r),locale:e.myLocale},{default:l(()=>[o("div",Ne,[N(a(C,{label:"Cerrar",color:"primary",flat:""},null,512),[[U]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.user.rol_name=="ADMINISTRADOR"||e.user.rol_name=="SUPER-ADMINISTRADOR"?(v(),$(de,{key:0,filled:"",required:"",dense:"","emit-value":"","map-options":"",style:{width:"29%","margin-left":"27px"},modelValue:e.formFiltrarCompras.pv_id,"onUpdate:modelValue":s[5]||(s[5]=r=>e.formFiltrarCompras.pv_id=r),options:e.listPV},X({"no-option":l(()=>[a(me,null,{default:l(()=>[a(ie,{class:"text-grey"},{default:l(()=>[D(" No hay resultados ")]),_:1})]),_:1})]),_:2},[e.formFiltrarCompras.pv_id!==""?{name:"append",fn:l(()=>[a(b,{name:"cancel",onClick:s[4]||(s[4]=Y(r=>e.formFiltrarCompras.pv_id="",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"])):A("",!0),a(C,{round:"",color:"black",icon:"search",loading:e.loading,class:"q-ml-md",onClick:e.filtarVentas},null,8,["loading","onClick"])])}var Te=P(ke,[["render",Re]]);const Me=[{name:"acciones",label:"acciones",align:"center"},{name:"punto_venta",label:"Punto de Venta",align:"center",field:"pv_nombre"},{name:"num_comprobante",label:"Num Comprobante",field:"num_comprobante"},{name:"usuario",label:"Usuario",align:"center",field:"usuario",headerStyle:"width: 200px"},{name:"proveedor",label:"Proveedor",align:"center",field:"proveedor",headerStyle:"width: 200px"},{name:"fecha",label:"Fecha/Hora",align:"center",field:"fecha",headerStyle:"width: 100px"},{name:"total",label:"Total",field:"total"},{name:"estado",label:"Estado",field:"estado",align:"center"}],Ue=x({name:"IndexCompras",components:{DetalleCompra:Se,FiltrarCompras:Te},setup(){const e=c([]),s=G(),m=c(!1),d=c({desde:"",hasta:"",pv_id:""}),i=c(""),u=c({}),{validarPermisos:r}=se(),{mostrarNotify:y}=B(),t=re(),p=O(),q=c(!1),{claim:{user:V}}=K.read(p.token),S=async()=>{try{q.value=!0;let n=0;V.rol_name=="ADMINISTRADOR"||V.rol_name=="SUPER-ADMINISTRADOR"?n=p.pv_selected_admin:n=V.pv_id;const{data:f}=await F.post("/compras/consulta",{pv_id:n,filter:i.value,desde:d.value.desde,hasta:d.value.hasta});f.compras.map(g=>{const h=g.fecha_compra.split("T")[0].split("-"),k=g.hora_compra.split(":");g.fecha=`${h[2]}/${h[1]}/${h[0]}  ${k[0]}:${k[1]} ${k[0]<12?"am":"pm"}`}),e.value=f.compras,q.value=!1}catch(n){console.log(n),q.value=!1}},j=n=>{t.dialog({title:"<center>\xBFEstas Seguro de anular esta compra?</center>",message:`<span><strong>Num Comprobante</strong>: ${n.num_comprobante}</span> <br>
                <span class='q-my-lg'><strong>Proveedor</strong>: ${n.proveedor}</span> <br>
                <span class='q-my-lg'><strong>Fecha/Hora</strong>: ${n.fecha}</span> <br>
                <span><strong>Total</strong>: $${n.total.toFixed(2)}</span> <br>`,html:!0,ok:{push:!0,label:"Anular",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{t.loading.show({message:"Cargando..."}),await F.put(`/compras/${n.id}`),y("positive","Factura Anulada exitosamente"),S(),t.loading.hide()}catch(f){console.log(f)}})},J=n=>{m.value=!0,u.value=n},H=n=>{e.value=n.compras,n.compras.map(f=>{const g=f.fecha_compra.split("T")[0].split("-"),h=f.hora_compra.split(":");f.fecha=`${g[2]}/${g[1]}/${g[0]}  ${h[0]}:${h[1]} ${h[0]<12?"am":"pm"}`})};return S(),Z(i,(n,f)=>{S()}),{actualizarLista:H,anularFactura:j,columns:Me,mostrarDetalleCompra:J,modalDetalleCompra:m,loading:q,compraData:u,filter:i,formFiltrarCompras:d,rows:e,router:s,validarPermisos:r,user:V}}}),ze={class:"row q-py-lg q-pl-md"},Le={class:"col-md-3 flex justify-end"},Ee={class:"row"},Oe={class:"col-md-12 col-xs-12"},Be={class:"q-pa-md"},je={class:"q-mr-xl text-h5 text-weight-regular"},Je={class:"full-width row flex-center text-lime-10 q-gutter-sm"},He=o("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1);function We(e,s,m,d,i,u){const r=R("FiltrarCompras"),y=R("DetalleCompra");return v(),z(ae,null,[a(le,null,{default:l(()=>[o("div",ze,[a(r,{onActualizarLista:e.actualizarLista,user:e.user,formFiltrarCompras:e.formFiltrarCompras},null,8,["onActualizarLista","user","formFiltrarCompras"]),o("div",Le,[e.validarPermisos("Agregar Compra")&&!e.$q.screen.xs?(v(),$(C,{key:0,color:"secondary",label:"Agregar Compra",class:"q-mr-md",onClick:s[0]||(s[0]=t=>e.$router.push("/compras/add"))})):A("",!0)])]),o("div",Ee,[o("div",Oe,[o("div",Be,[a(L,{class:"table-ventas",rows:e.rows,columns:e.columns,loading:e.loading,"row-key":"name"},{top:l(()=>[o("label",je,[D("Listado de Compras "),a(b,{name:"fa fa fa-cash-register",size:"30px",color:"secondary"})]),a(oe),a(Q,{dense:"",debounce:"1000",color:"primary",modelValue:e.filter,"onUpdate:modelValue":s[1]||(s[1]=t=>e.filter=t)},{append:l(()=>[a(b,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-total":l(t=>[a(w,{props:t},{default:l(()=>[D(" $"+_(t.row.total.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-estado":l(t=>[a(w,{props:t},{default:l(()=>[a(E,{outline:"",class:"q-py-xs q-px-md",color:t.row.estado?"secondary":"negative",label:t.row.estado?"Aceptado":"Anulado"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":l(t=>[a(w,{props:t},{default:l(()=>[a(C,{round:"",color:"blue-grey",icon:"visibility",class:"q-mr-sm",onClick:p=>e.mostrarDetalleCompra(t.row),size:"10px"},null,8,["onClick"]),t.row.estado?(v(),$(C,{key:0,round:"",color:"blue-grey",onClick:p=>e.anularFactura(t.row),icon:"close",size:"10px"},null,8,["onClick"])):A("",!0)]),_:2},1032,["props"])]),"no-data":l(({icon:t,filter:p})=>[o("div",Je,[a(b,{size:"2em",name:"sentiment_dissatisfied"}),He,a(b,{size:"2em",name:p?"filter_b_and_w":t},null,8,["name"])])]),_:1},8,["rows","columns","loading"])])])])]),_:1}),e.$q.screen.xs&&e.validarPermisos("Agregar Compra")?(v(),$(te,{key:0,position:"bottom-right",offset:[18,18]},{default:l(()=>[a(C,{round:"",color:"secondary",size:"lg",icon:"add",onClick:s[2]||(s[2]=t=>e.$router.push("/ventas/add"))})]),_:1})):A("",!0),a(ee,{modelValue:e.modalDetalleCompra,"onUpdate:modelValue":s[3]||(s[3]=t=>e.modalDetalleCompra=t)},{default:l(()=>[a(y,{compraData:e.compraData},null,8,["compraData"])]),_:1},8,["modelValue"])],64)}var ma=P(Ue,[["render",We]]);export{ma as default};
