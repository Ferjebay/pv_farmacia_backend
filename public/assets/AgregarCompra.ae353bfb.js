import{e as X,d as Y,Q as G}from"./QList.ffb79e57.js";import{d as R,r as u,a as N,_ as j,o as C,aa as V,g as n,f as l,aW as D,e as t,h as $,i as I,ac as w,ad as A,aX as J,u as Z,m as ee,ae as U,c as oe,aT as T,ag as ae,Q as y,bi as le,ab as te}from"./index.e02e0fd9.js";import{Q as O,a as v}from"./QTable.7676999b.js";import{Q as re}from"./QBadge.5c85781b.js";import{Q as ne}from"./QForm.0c336d83.js";import{Q as se}from"./QPage.b9acbce1.js";import{u as M,A as q}from"./Api.e3a65a9d.js";import{u as de,a as ie}from"./useHelpers.6f57171d.js";import{A as ce}from"./Add.720564ba.js";import{Q as ue}from"./QInnerLoading.6f65ce49.js";import"./index.2cf0d985.js";const me=[{name:"add",label:"Agregar",align:"left",field:"add"},{name:"cod_barra",label:"Codigo Barra",align:"left",field:"cod_barra"},{name:"pv_nombre",label:"Punto de Venta",align:"center",field:"pv_nombre"},{name:"producto",label:"Producto",align:"left",field:"producto"},{name:"fxc",label:"F. por Caja",align:"center",field:"fxc"},{name:"cajas",label:"Stock Cajas",align:"center",field:"cajas"},{name:"fracciones",label:"Stock Fracciones",align:"center",field:"fracciones"},{name:"pvp",label:"P. Caja",align:"center",field:"pvp"},{name:"p_unit",label:"P. Unit.",align:"center",field:"p_unit"},{name:"descuento",label:"Descuento",align:"center",field:"descuento"},{name:"iva",label:"IVA",align:"center",field:"aplicaIva"}],pe=R({name:"buscar-producto",props:["productos"],setup(o,{emit:r}){const _=u([]),b=u(!1),h=M(),{claim:{user:c}}=N.read(h.token);o.productos.map(e=>{e.cajas=e.fracciones_total!==0?parseInt(e.fracciones_total/e.fxc):0,e.fracciones=e.fracciones_total!==0?parseInt(e.fracciones_total%e.fxc):0}),_.value=o.productos;let s=0;return c.rol_name=="ADMINISTRADOR"||c.rol_name=="SUPER-ADMINISTRADOR"?s=h.pv_selected_admin:s=c.pv_id,{agregarProducto:e=>{r("addArticle",e)},columns:me,loading:b,rows:_,pv_busqueda:s,user:c}}}),fe=t("div",{class:"text-h6 text-center"},"Buscar Producto",-1),ge={class:"row q-gutter-sm"},ve={class:"col-sm-12 q-my-sm"};function _e(o,r,_,b,h,c){return C(),V(J,{style:{width:"1040px","max-width":"80vw"}},{default:n(()=>[l(D,{class:"q-pb-none"},{default:n(()=>[fe]),_:1}),l(D,null,{default:n(()=>[t("div",ge,[t("div",ve,[l(O,{class:"my-sticky-header-table2",rows:o.rows,columns:o.columns,loading:o.loading,"hide-bottom":"","row-key":"name"},{"body-cell-add":n(s=>[l(v,{props:s},{default:n(()=>[o.pv_busqueda==s.row.pv_id?(C(),V($,{key:0,round:"",color:"green-10",class:"q-ml-md",size:"sm",onClick:p=>o.agregarProducto(s.row),icon:"fa-solid fa-plus"},null,8,["onClick"])):(C(),V(I,{key:1,color:"blue-grey-8",class:"q-ml-md",size:"sm",name:"fa-solid fa-ban"}))]),_:2},1032,["props"])]),"body-cell-descuento":n(s=>[l(v,{props:s},{default:n(()=>[w(A(s.row.descuento)+"% ",1)]),_:2},1032,["props"])]),"body-cell-pvp":n(s=>[l(v,{props:s},{default:n(()=>[w("$"+A(s.row.pvp),1)]),_:2},1032,["props"])]),"body-cell-p_unit":n(s=>[l(v,{props:s},{default:n(()=>[w("$"+A(s.row.p_unit),1)]),_:2},1032,["props"])]),loading:n(()=>[l(ue,{showing:"",color:"primary"})]),_:1},8,["rows","columns","loading"])])])]),_:1})]),_:1})}var be=j(pe,[["render",_e]]);const he=[{name:"acciones",label:"Quitar",align:"left"},{name:"cod_barra",label:"Codigo Barra",align:"left",field:"cod_barra"},{name:"producto",label:"Producto",align:"left",field:"producto"},{name:"cantidad",label:"Cajas",align:"center",field:"cantidad"},{name:"f_c",label:"F/C",align:"center",field:"f_c"},{name:"fxc",label:"F. por caja",align:"center",field:"fxc"},{name:"cajas",label:"T. cajas",align:"center",field:"cajas"},{name:"fracciones",label:"T. fracciones",align:"center",field:"fracciones"},{name:"pvm",label:"Costo Neto",align:"center",field:"pvm"},{name:"v_total",label:"Valor Total",align:"center",field:"v_total"}];let x=[];const ye=R({name:"AddCompra",components:{Add:ce,Search:be},setup(){const o=u([]),r=u([]),_=u(!1),b=u(!1),h=u([]),c=u(!1),{mostrarNotify:s}=de(),p=ie(),e=u({proveedor_id:"",numComprobante:"",descripcion:""}),f=u({sortBy:"desc",descending:!1,page:1,rowsPerPage:25,rowsNumber:25}),P=u(""),B=Z(),S=M(),{claim:{user:m}}=N.read(S.token),F=a=>{if(o.value.some(i=>i.cod_barra==a.cod_barra))s("warning","Ya fue agregado este articulo");else{const i=a.fracciones_total,g=a.fxc;a.cajas=i!==0?parseInt(i/g):0,a.fracciones=i!==0?parseInt(i%g):0,a.pvp=a.pvp.toFixed(2),a.p_unit=a.p_unit.toFixed(2),a.cant_venta=0,a.f_c=0,a.v_total=0 .toFixed(2),o.value.unshift(a),P.value=""}},z=async()=>{if(P.value.length==0)return s("warning","Ingresa el codigo IMEI");try{c.value=!0;let a=0;m.rol_name=="ADMINISTRADOR"||m.rol_name=="SUPER-ADMINISTRADOR"?a=S.pv_selected_admin:a=m.pv_id;const{data:d}=await q.get(`/articulos/${P.value}/${a}`);if(d.articulo.length>1)return h.value=d.articulo,b.value=!0,c.value=!1;if(d.articulo.length==0)return c.value=!1,s("warning","No se encontro el articulo...");F(d.articulo[0]),c.value=!1}catch(a){console.log(a),c.value=!1}},E=a=>{F(a),b.value=!1},L=a=>{let d=a.fxc*a.cant_venta+parseInt(a.f_c),i=a.pvm/a.fxc;a.v_total=(d*i).toFixed(2)},K=a=>{const d=o.value.findIndex(i=>i.id==a);o.value.splice(d,1)},k=async()=>{_.value=!1;try{const{data:{proveedores:a}}=await q.get("/proveedores/true");r.value=[],a.forEach(d=>{r.value.push({label:d.razon_social,value:d.id,cedula:d.numero_documento})}),x=r.value}catch(a){console.log(a)}},Q=ee(()=>{let a=0,d=0,i=0,g=0;return o.value.forEach(W=>{a+=parseFloat(W.v_total)}),g=a+d-i,{subtotal:a.toFixed(2),iva:d.toFixed(2),descuento:i.toFixed(2),total:g.toFixed(2)}}),H=async()=>{if(e.value.proveedor_id=="")return s("warning","Debes elegir algun proveedor");if(e.value.numComprobante=="")return s("warning","Por favor ingresa el numero de comprobante");if(e.value.descripcion=="")return s("warning","Por favor ingresa una descripci\xF3n");if(o.value.length==0)return s("warning","Debes agregar algun producto..");let a=0;m.rol_name=="ADMINISTRADOR"||m.rol_name=="SUPER-ADMINISTRADOR"?a=S.pv_selected_admin:a=m.pv_id,e.value.usuario_id=m.id,e.value.usuario_name=`${m.nombres.split(" ")[0]} ${m.apellidos}`,e.value.pv_id=a,e.value.detalle=o.value,e.value.valoresFactura=Q.value;try{p.dialog({title:"\xBFDeseas Agregar esta Compra?",ok:{push:!0,label:"Agregar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{p.loading.show({message:"Cargando..."}),await q.post("/compras/add",e.value),p.loading.hide(),s("positive","Compra realizada exitosamente"),B.push("/compras")})}catch(d){console.log(d),p.loading.hide()}};return k(),{addArticle:E,calcularCostoVentaProducto:L,columns:he,formCompras:e,filterByCodBarra:P,filterArticulo:z,listProveedores:r,loadingState:c,getProveedores:k,modalAgregarProveedor:_,modalBuscarProducto:b,pagination:f,productos:h,rows:o,valorFactura:Q,router:B,filterFn(a,d){if(a===""){d(()=>{r.value=x});return}d(()=>{const i=a.toLowerCase();r.value=r.value.filter(g=>g.cedula.indexOf(i)>-1||g.label.toLowerCase().indexOf(i)>-1)})},onSubmit:H,quitarArticulo:K}}}),Ce={class:"row q-my-lg q-pl-md"},we={class:"col-md-5 q-mt-lg"},Ae=t("label",null,"Seleccionar Proveedor: ",-1),Pe={class:"col-md-1 q-mt-lg btnAddCliente"},Ve={class:"col-md-4 q-mt-lg"},$e=t("label",null,"Numero de Comprobante: ",-1),Ie={class:"row q-my-lg q-pl-md"},Se={class:"col-md-5"},qe=t("label",null,"Filtrar por codigo de barra o nombre del producto:",-1),Be=t("div",{class:"col-md-1 q-mt-lg btnAddCliente"},null,-1),Fe={class:"col-md-4 q-mt-sm"},ke=t("label",null,"Descripci\xF3n: ",-1),Qe={class:"row"},De={class:"col-md-12"},Ue={class:"q-pa-md"},Te={class:"full-width row flex-center text-lime-10 q-gutter-sm"},xe=t("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1),Re={class:"col-md-12",style:{display:"flex","justify-content":"end"}},Ne={style:{"margin-right":"30px"}},je={class:"text-right"},Oe=t("td",null,[t("b",null,"SUBTOTAL:")],-1),Me={style:{width:"90px"},class:"text-subtitle1 text-weight-regular"},ze={class:"text-right"},Ee=t("td",null,[t("b",null,"TOTAL DE COMPRA:")],-1),Le={style:{width:"90px"}},Ke={class:"col-md-4 offset-4"};function He(o,r,_,b,h,c){const s=U("Add"),p=U("Search");return C(),oe(ae,null,[l(se,null,{default:n(()=>[t("div",Ce,[t("div",we,[Ae,l(X,{color:"orange",filled:"",modelValue:o.formCompras.proveedor_id,"onUpdate:modelValue":r[0]||(r[0]=e=>o.formCompras.proveedor_id=e),dense:"",options:o.listProveedores,"emit-value":"","map-options":"",onFilter:o.filterFn,"use-input":"","input-debounce":"0"},{"no-option":n(()=>[l(Y,null,{default:n(()=>[l(G,{class:"text-grey"},{default:n(()=>[w(" No hay resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter"])]),t("div",Pe,[l($,{round:"",color:"primary",onClick:r[1]||(r[1]=e=>o.modalAgregarProveedor=!0),icon:"person_add"})]),t("div",Ve,[$e,l(y,{modelValue:o.formCompras.numComprobante,"onUpdate:modelValue":r[2]||(r[2]=e=>o.formCompras.numComprobante=e),dense:"",filled:"",required:""},null,8,["modelValue"])])]),t("div",Ie,[t("div",Se,[qe,l(y,{outlined:"","bottom-slots":"",loading:o.loadingState,modelValue:o.filterByCodBarra,"onUpdate:modelValue":r[4]||(r[4]=e=>o.filterByCodBarra=e),modelModifiers:{trim:!0},onKeyup:le(o.filterArticulo,["enter"])},{append:n(()=>[o.filterByCodBarra!==""?(C(),V(I,{key:0,name:"close",onClick:r[3]||(r[3]=e=>o.filterByCodBarra=""),class:"cursor-pointer"})):te("",!0),l(I,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])]),Be,t("div",Fe,[ke,l(y,{modelValue:o.formCompras.descripcion,"onUpdate:modelValue":r[5]||(r[5]=e=>o.formCompras.descripcion=e),dense:"",filled:"",required:""},null,8,["modelValue"])])]),l(ne,{onSubmit:o.onSubmit},{default:n(()=>[t("div",Qe,[t("div",De,[t("div",Ue,[l(O,{rows:o.rows,columns:o.columns,"row-key":"name",pagination:o.pagination,"onUpdate:pagination":r[6]||(r[6]=e=>o.pagination=e),class:"my-sticky-header-table3"},{"no-data":n(({})=>[t("div",Te,[xe,l(I,{size:"2em",name:"playlist_add"})])]),"body-cell-cantidad":n(e=>[l(v,{props:e},{default:n(()=>[l(y,{"input-class":"resaltarTextoInput",dense:"",required:"",onChange:f=>o.calcularCostoVentaProducto(e.row),min:"0",type:"number",style:{width:"100px"},modelValue:e.row.cant_venta,"onUpdate:modelValue":f=>e.row.cant_venta=f,modelModifiers:{trim:!0}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-f_c":n(e=>[l(v,{props:e},{default:n(()=>[l(y,{"input-class":"resaltarTextoInput",dense:"",required:"",min:"0",onChange:f=>o.calcularCostoVentaProducto(e.row),disable:e.row.fxc==1,type:"number",style:{width:"100px"},modelValue:e.row.f_c,"onUpdate:modelValue":f=>e.row.f_c=f,modelModifiers:{trim:!0}},null,8,["onChange","disable","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-pvm":n(e=>[l(v,{props:e},{default:n(()=>[w(" $"+A(e.row.pvm.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-acciones":n(e=>[l(v,{props:e},{default:n(()=>[l($,{round:"",color:"deep-orange",onClick:f=>o.quitarArticulo(e.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])])]),t("div",Re,[t("table",Ne,[t("tr",je,[Oe,t("td",Me," $"+A(o.valorFactura.subtotal),1)]),t("tr",ze,[Ee,t("td",Le,[l(re,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${o.valorFactura.total}`},null,8,["label"])])])])]),t("div",Ke,[l($,{square:"",color:"green-10",type:"submit",label:"Agregar Compra",class:"full-width",icon:"shopping_cart"})])])]),_:1},8,["onSubmit"])]),_:1}),l(T,{modelValue:o.modalAgregarProveedor,"onUpdate:modelValue":r[7]||(r[7]=e=>o.modalAgregarProveedor=e)},{default:n(()=>[l(s,{onActualizarLista:o.getProveedores},null,8,["onActualizarLista"])]),_:1},8,["modelValue"]),l(T,{modelValue:o.modalBuscarProducto,"onUpdate:modelValue":r[8]||(r[8]=e=>o.modalBuscarProducto=e)},{default:n(()=>[l(p,{productos:o.productos,onAddArticle:o.addArticle},null,8,["productos","onAddArticle"])]),_:1},8,["modelValue"])],64)}var ro=j(ye,[["render",He]]);export{ro as default};
