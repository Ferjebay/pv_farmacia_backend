import{d as N,r as d,_ as T,o as V,aa as q,g as l,f as t,aW as U,e as a,ad as f,ac as w,aX as G,c as O,i as y,Y as Q,h as b,Q as I,bh as K,w as Z,ab as A,bf as ee,u as ae,a as te,C as le,ae as M,aT as se,ag as oe}from"./index.e02e0fd9.js";import{Q as P}from"./QBadge.5c85781b.js";import{Q as ne}from"./QSpace.290b7cf2.js";import{Q as j,a as $}from"./QTable.7676999b.js";import{Q as re}from"./QPage.b9acbce1.js";import{Q as ie}from"./QPageSticky.51a05daf.js";import{A as F,u as B}from"./Api.e3a65a9d.js";import{u as de}from"./useRolPermisos.82749469.js";import{u as J,a as ce}from"./useHelpers.6f57171d.js";import{Q as me}from"./QInnerLoading.6f65ce49.js";import{Q as z,a as L,C as E}from"./ClosePopup.a58b803f.js";import{Q as ue,d as fe,e as pe}from"./QList.ffb79e57.js";import"./index.2cf0d985.js";import"./date.cb1dcd19.js";const _e=[{name:"cod_barra",label:"Codigo Barra",align:"left",field:"cod_barra"},{name:"producto",label:"Producto",align:"left",field:"producto"},{name:"cajas",label:"Cajas V.",align:"center",field:"cajas"},{name:"fracciones",label:"Fracciones V.",align:"center",field:"fracciones"},{name:"pvp",label:"P. Caja",align:"center",field:"pvp"},{name:"p_unit",label:"P. Unit.",align:"center",field:"p_unit"},{name:"descuento",label:"Descuento",align:"center",field:"d_a"},{name:"iva",label:"IVA",align:"center",field:"aplicaIva"},{name:"v_total",label:"Valor Total",align:"center",field:"subtotal"}],ge=N({name:"detalleFactura",props:["facturaData"],setup(e){const o=d([]),p=d(!1),c=d("---"),i=d("---"),m=d("---");return(async()=>{try{p.value=!0;const{data:_}=await F.get(`/ventas/${e.facturaData.id}`);c.value=_.detalleVenta[0].sub_fact.toFixed(2),i.value=_.detalleVenta[0].iva.toFixed(2),m.value=_.detalleVenta[0].descuento.toFixed(2),o.value=_.detalleVenta,p.value=!1}catch(_){p.value=!1,console.log(_)}})(),{columns:_e,loading:p,rows:o,subtotal:c,iva:i,descuento:m}}}),ve=a("div",{class:"text-h6 text-center"},"Detalle de la Factura",-1),be={class:"row q-gutter-sm"},he=a("div",{class:"col-sm-5 text-right"},[a("label",{class:"text-subtitle1 text-weight-medium"},"Num. Comprobantes:")],-1),Ve={class:"col-sm-5 q-ml-lg q-mt-sm flex items-center"},ye=a("div",{class:"col-sm-5 text-right q-mt-none"},[a("label",{class:"text-subtitle1 text-weight-medium"},"Clave de Acceso:")],-1),we={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},$e=a("div",{class:"col-sm-5 text-right q-mt-none"},[a("label",{class:"text-subtitle1 text-weight-medium"},"Punto de Venta:")],-1),Fe={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},qe=a("div",{class:"col-sm-5 text-right q-mt-none"},[a("label",{class:"text-subtitle1 text-weight-medium"},"Cliente:")],-1),De={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},xe=a("div",{class:"col-sm-5 text-right q-mt-none"},[a("label",{class:"text-subtitle1 text-weight-medium"},"Usuario:")],-1),Ae={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},Ce=a("div",{class:"col-sm-5 text-right q-mt-none"},[a("label",{class:"text-subtitle1 text-weight-medium"},"Fecha:")],-1),Se={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},ke=a("div",{class:"col-sm-5 text-right q-mt-none"},[a("label",{class:"text-subtitle1 text-weight-medium"},"Subtotal:")],-1),Qe={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},Ie=a("div",{class:"col-sm-5 text-right q-mt-none"},[a("label",{class:"text-subtitle1 text-weight-medium"},"IVA(12%):")],-1),Pe={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},Ne=a("div",{class:"col-sm-5 text-right q-mt-none"},[a("label",{class:"text-subtitle1 text-weight-medium"},"Descuento:")],-1),Te={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},Re=a("div",{class:"col-sm-5 text-right q-mt-none"},[a("label",{class:"text-subtitle1 text-weight-medium"},"Total de Pago:")],-1),Ue={class:"col-sm-5 q-ml-lg q-mt-none flex items-center"},Me={class:"col-sm-12 q-my-sm"};function ze(e,o,p,c,i,m){return V(),q(G,{style:{width:"910px","max-width":"80vw"}},{default:l(()=>[t(U,{class:"q-pb-none"},{default:l(()=>[ve]),_:1}),t(U,null,{default:l(()=>[a("div",be,[he,a("div",Ve,[a("label",null,f(e.facturaData.num_comprobante),1)]),ye,a("div",we,[a("label",null,f(e.facturaData.clave_acceso),1)]),$e,a("div",Fe,[a("label",null,f(e.facturaData.pv_nombre),1)]),qe,a("div",De,[a("label",null,f(e.facturaData.cliente),1)]),xe,a("div",Ae,[a("label",null,f(e.facturaData.usuario),1)]),Ce,a("div",Se,[a("label",null,f(e.facturaData.fecha),1)]),ke,a("div",Qe,[a("label",null,f(e.subtotal),1)]),Ie,a("div",Pe,[a("label",null,f(e.iva),1)]),Ne,a("div",Te,[a("label",null,f(e.descuento),1)]),Re,a("div",Ue,[t(P,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${e.facturaData.total.toFixed(2)}`},null,8,["label"])]),a("div",Me,[t(j,{class:"my-sticky-header-table2",rows:e.rows,columns:e.columns,loading:e.loading,"hide-bottom":"","row-key":"name"},{"body-cell-indice":l(n=>[t($,{props:n},{default:l(()=>[w(f(n.pageIndex+1),1)]),_:2},1032,["props"])]),"body-cell-descuento":l(n=>[t($,{props:n},{default:l(()=>[w(f(n.row.d_a)+"% ",1)]),_:2},1032,["props"])]),"body-cell-v_total":l(n=>[t($,{props:n},{default:l(()=>[w("$"+f(n.row.subtotal.toFixed(2)),1)]),_:2},1032,["props"])]),loading:l(()=>[t(me,{showing:"",color:"primary"})]),_:1},8,["rows","columns","loading"])])])]),_:1})]),_:1})}var Le=T(ge,[["render",ze]]);const Ee=N({name:"FiltrarVentas",props:["user","formFiltrarVentas"],setup(e,{emit:o}){const p=B(),c=d([]),i=d(!1),{mostrarNotify:m}=J(),n=async()=>{try{const{data:{pv:s}}=await F.get("/ventas/getPV");c.value=[],s.forEach(g=>{c.value.push({label:g.nombre,value:g.id})})}catch(s){console.log(s)}},_=async()=>{if(e.formFiltrarVentas.desde!=""&&e.formFiltrarVentas.hasta==""||e.formFiltrarVentas.desde==""&&e.formFiltrarVentas.hasta!="")return m("warning","Completa los campos de fecha de busqueda");if(e.formFiltrarVentas.desde>e.formFiltrarVentas.hasta)return m("warning","Error en el rango de fecha de busqueda");i.value=!0;try{e.formFiltrarVentas.pv_id==""&&(e.user.rol_name=="ADMINISTRADOR"||e.user.rol_name=="SUPER-ADMINISTRADOR"?e.formFiltrarVentas.pv_id=p.pv_selected_admin:e.formFiltrarVentas.pv_id=e.user.pv_id);const{data:s}=await F.post("/ventas/consulta",e.formFiltrarVentas);o("actualizarLista",s)}catch(s){console.log(s)}i.value=!1};return n(),{listPV:c,loading:i,filtarVentas:_,myLocale:{days:"Domingo_Lunes_Martes_Mi\xE9rcoles_Jueves_Viernes_S\xE1bado".split("_"),daysShort:"Dom_Lun_Mar_Mi\xE9_Jue_Vie_S\xE1b".split("_"),months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),monthsShort:"Ene_Feb_Mar_Abr_May_Jun_Jul_Ago_Sep_Oct_Nov_Dic".split("_"),firstDayOfWeek:1,format24h:!0,pluralDay:"dias"}}}}),Oe={class:"col-md-9 col-sm-8 flex items-center"},je=a("label",null,"Filtrar Por:",-1),Be={class:"row items-center justify-end"},Je=a("label",{class:"q-mx-md"},"HASTA:",-1),He={class:"row items-center justify-end"};function We(e,o,p,c,i,m){return V(),O("div",Oe,[je,t(I,{class:"q-ml-md",style:{width:"20%"},filled:"",modelValue:e.formFiltrarVentas.desde,"onUpdate:modelValue":o[1]||(o[1]=n=>e.formFiltrarVentas.desde=n),dense:"",mask:"date",clearable:"","clear-icon":"close"},{append:l(()=>[t(y,{name:"event",class:"cursor-pointer"},{default:l(()=>[t(z,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[t(L,{modelValue:e.formFiltrarVentas.desde,"onUpdate:modelValue":o[0]||(o[0]=n=>e.formFiltrarVentas.desde=n),locale:e.myLocale},{default:l(()=>[a("div",Be,[Q(t(b,{label:"Cerrar",color:"primary",flat:""},null,512),[[E]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),Je,t(I,{filled:"",style:{width:"20%"},modelValue:e.formFiltrarVentas.hasta,"onUpdate:modelValue":o[3]||(o[3]=n=>e.formFiltrarVentas.hasta=n),dense:"",mask:"date",clearable:"","clear-icon":"close"},{append:l(()=>[t(y,{name:"event",class:"cursor-pointer"},{default:l(()=>[t(z,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[t(L,{modelValue:e.formFiltrarVentas.hasta,"onUpdate:modelValue":o[2]||(o[2]=n=>e.formFiltrarVentas.hasta=n),locale:e.myLocale},{default:l(()=>[a("div",He,[Q(t(b,{label:"Cerrar",color:"primary",flat:""},null,512),[[E]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.user.rol_name=="ADMINISTRADOR"||e.user.rol_name=="SUPER-ADMINISTRADOR"?Q((V(),q(pe,{key:0,filled:"",required:"",dense:"","emit-value":"","map-options":"",style:{width:"29%","margin-left":"27px"},modelValue:e.formFiltrarVentas.pv_id,"onUpdate:modelValue":o[5]||(o[5]=n=>e.formFiltrarVentas.pv_id=n),options:e.listPV},K({"no-option":l(()=>[t(fe,null,{default:l(()=>[t(ue,{class:"text-grey"},{default:l(()=>[w(" No hay resultados ")]),_:1})]),_:1})]),_:2},[e.formFiltrarVentas.pv_id!==""?{name:"append",fn:l(()=>[t(y,{name:"cancel",onClick:o[4]||(o[4]=Z(n=>e.formFiltrarVentas.pv_id="",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"])),[[ee,!1]]):A("",!0),t(b,{round:"",color:"black",icon:"search",loading:e.loading,class:"q-ml-md",onClick:e.filtarVentas},null,8,["loading","onClick"])])}var Xe=T(Ee,[["render",We]]);const Ye=[{name:"acciones",label:"acciones",align:"center"},{name:"punto_venta",label:"Punto de Venta",align:"center",field:"pv_nombre"},{name:"num_comprobante",label:"Num Comprobante",field:"num_comprobante"},{name:"usuario",label:"Usuario",align:"center",field:"usuario",headerStyle:"width: 200px"},{name:"cliente",label:"Cliente",align:"center",field:"cliente",headerStyle:"width: 200px"},{name:"fecha",label:"Fecha/Hora",align:"center",field:"fecha",headerStyle:"width: 100px"},{name:"total",label:"Total",field:"totalPago"},{name:"estado",label:"Estado",field:"estado",align:"center"}],Ge=N({name:"IndexVentas",components:{DetalleFactura:Le,FiltrarVentas:Xe},setup(){const e=d([]),o=ae(),p=d(!1),c=d({desde:"",hasta:"",pv_id:""}),i=d(0),m=d(""),n=d({}),{validarPermisos:_}=de(),{mostrarNotify:s}=J(),g=ce(),R=B(),D=d(!1),C=d(!1),{claim:{user:x}}=te.read(R.token),S=async()=>{try{D.value=!0;let r=0;x.rol_name=="ADMINISTRADOR"||x.rol_name=="SUPER-ADMINISTRADOR"?r=R.pv_selected_admin:r=x.pv_id;const{data:u}=await F.post("/ventas/consulta",{pv_id:r,filter:m.value,desde:c.value.desde,hasta:c.value.hasta});i.value=0,u.facturas.map(v=>{v.estado&&(i.value+=v.total);const h=v.fecha_emision.split("T")[0].split("-"),k=v.hora_emision.split(":");v.fecha=`${h[2]}/${h[1]}/${h[0]}  ${k[0]}:${k[1]} ${k[0]<12?"am":"pm"}`}),e.value=u.facturas,D.value=!1}catch(r){console.log(r),D.value=!1}},H=r=>{g.dialog({title:"<center>\xBFEstas Seguro de anular esta Factura?</center>",message:`<span><strong>Num Comprobante</strong>: ${r.num_comprobante}</span> <br>
                <span class='q-my-lg'><strong>Cliente</strong>: ${r.cliente}</span> <br>
                <span class='q-my-lg'><strong>Fecha/Hora</strong>: ${r.fecha}</span> <br>
                <span><strong>Total</strong>: $${r.total.toFixed(2)}</span> <br>`,html:!0,ok:{push:!0,label:"Anular",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{g.loading.show({message:"Cargando..."}),await F.put(`/ventas/${r.id}`),s("positive","Factura Anulada exitosamente"),S(),g.loading.hide()}catch(u){console.log(u)}})},W=r=>{p.value=!0,n.value=r},X=async r=>{try{C.value=!0,await F.post("/ventas/imprimirFactura",r),C.value=!1}catch(u){console.log(u)}},Y=r=>{i.value=0,e.value=r.facturas,r.facturas.map(u=>{u.estado&&(i.value+=u.total);const v=u.fecha_emision.split("T")[0].split("-"),h=u.hora_emision.split(":");u.fecha=`${v[2]}/${v[1]}/${v[0]}  ${h[0]}:${h[1]} ${h[0]<12?"am":"pm"}`})};return S(),le(m,(r,u)=>{S()}),{actualizarLista:Y,anularFactura:H,columns:Ye,mostrarDetalleFactura:W,modalDetalleFactura:p,loading:D,loadingImpresion:C,facturaData:n,filter:m,formFiltrarVentas:c,rows:e,router:o,totalVentas:i,validarPermisos:_,imprimirFactura:X,user:x}}}),Ke={class:"row q-py-lg q-pl-md"},Ze={class:"col-md-3 col-sm-3 flex justify-end"},ea={class:"row"},aa={class:"col-md-12 col-xs-12"},ta={class:"q-pa-md"},la={class:"q-mr-xl text-h5 text-weight-regular"},sa={class:"q-ml-xl q-pl-xl text-subtitle1"},oa=a("b",null,"TOTAL DE VENTAS:",-1),na={class:"full-width row flex-center text-lime-10 q-gutter-sm"},ra=a("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1);function ia(e,o,p,c,i,m){const n=M("FiltrarVentas"),_=M("DetalleFactura");return V(),O(oe,null,[t(re,null,{default:l(()=>[a("div",Ke,[t(n,{onActualizarLista:e.actualizarLista,user:e.user,formFiltrarVentas:e.formFiltrarVentas},null,8,["onActualizarLista","user","formFiltrarVentas"]),a("div",Ze,[e.validarPermisos("Agregar Venta")&&!e.$q.screen.xs?(V(),q(b,{key:0,color:"secondary",label:"nueva Venta",class:"q-mr-md",onClick:o[0]||(o[0]=s=>e.$router.push("/ventas/add"))})):A("",!0)])]),a("div",ea,[a("div",aa,[a("div",ta,[t(j,{class:"table-ventas",rows:e.rows,columns:e.columns,loading:e.loading,"row-key":"name"},{top:l(()=>[a("label",la,[w("Listado de Ventas "),t(y,{name:"fa fa fa-cash-register",size:"30px",color:"secondary"})]),a("label",sa,[oa,t(P,{outline:"",class:"q-px-md text-subtitle1 q-ml-sm text-weight-bold",color:"blue-grey",label:`$${e.totalVentas.toFixed(2)}`},null,8,["label"])]),t(ne),t(I,{dense:"",debounce:"1000",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=s=>e.filter=s)},{append:l(()=>[t(y,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-total":l(s=>[t($,{props:s,class:"totalVenta text-weight-regular"},{default:l(()=>[w(" $"+f(s.row.total.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-estado":l(s=>[t($,{props:s},{default:l(()=>[t(P,{outline:"",class:"q-py-xs q-px-md",color:s.row.estado?"secondary":"negative",label:s.row.estado?"Aceptado":"Anulado"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":l(s=>[t($,{props:s},{default:l(()=>[t(b,{round:"",color:"blue-grey",icon:"visibility",onClick:g=>e.mostrarDetalleFactura(s.row),class:"q-mr-sm",size:"10px"},null,8,["onClick"]),t(b,{round:"",color:"blue-grey",icon:"print",loading:e.loadingImpresion,onClick:g=>e.imprimirFactura(s.row),class:"q-mr-sm",size:"10px"},null,8,["loading","onClick"]),s.row.estado?(V(),q(b,{key:0,round:"",color:"blue-grey",icon:"close",onClick:g=>e.anularFactura(s.row),size:"10px"},null,8,["onClick"])):A("",!0)]),_:2},1032,["props"])]),"no-data":l(({icon:s,filter:g})=>[a("div",na,[t(y,{size:"2em",name:"sentiment_dissatisfied"}),ra,t(y,{size:"2em",name:g?"filter_b_and_w":s},null,8,["name"])])]),_:1},8,["rows","columns","loading"])])])])]),_:1}),e.$q.screen.xs&&e.validarPermisos("Agregar Venta")?(V(),q(ie,{key:0,position:"bottom-right",offset:[18,18]},{default:l(()=>[t(b,{round:"",color:"secondary",size:"lg",icon:"add",onClick:o[2]||(o[2]=s=>e.$router.push("/ventas/add"))})]),_:1})):A("",!0),t(se,{modelValue:e.modalDetalleFactura,"onUpdate:modelValue":o[3]||(o[3]=s=>e.modalDetalleFactura=s)},{default:l(()=>[t(_,{facturaData:e.facturaData},null,8,["facturaData"])]),_:1},8,["modelValue"])],64)}var $a=T(Ge,[["render",ia]]);export{$a as default};
